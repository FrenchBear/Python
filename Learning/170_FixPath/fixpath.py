# Shifts absolute coords in a Xaml Path markup
# https://learn.microsoft.com/en-us/dotnet/desktop/wpf/graphics-multimedia/path-markup-syntax
#
# 2025-12-14    PV

import re

data_re = re.compile(r'Data\s*=\s*"([^"]*)"')

dx = -79.639576
dy = -80.433336

xaml = """
        <Path Width="35.48" Height="63.60" Fill="Blue" Opacity="{Binding SegmentEOpacity}" Data="F1 M 85.979  114.498 c -0.8731 -0.5371 -1.6775 -1.1562 -2.4315 -1.8230 c -0.4154 -0.3704 -0.8176 -0.7620 -1.1986 -1.1748 c -0.5794 0.7488 -1.0848 1.5531 -1.4923 2.4104 c -0.8176 1.7145 -1.2197 3.6169 -1.2171 5.5139 v 0 v 11.4168 l 10.3796 -4.0428 v -10.5807 c -0.4233 -0.1085 -0.8440 -0.2355 -1.2621 -0.3837 c -0.9710 -0.3440 -1.9077 -0.7964 -2.7781 -1.3361 z"/>
        <Path Width="35.48" Height="63.60" Fill="Blue" Opacity="{Binding SegmentGOpacity}" Data="F1 M 108.183 113.535 c 0.80963 -0.49741 1.56369 -1.07685 2.27278 -1.70656 c 0.42597 -0.37835 0.83079 -0.78052 1.21179 -1.20121 c -0.38365 -0.42069 -0.78582 -0.8255 -1.21179 -1.20121 c -0.70909 -0.6297 -1.4658 -1.20914 -2.27278 -1.70656 c -0.80697 -0.49742 -1.66687 -0.91281 -2.56116 -1.23031 c -1.79123 -0.64294 -3.70681 -0.8599 -5.59859 -0.8599 h -5.28902 c -1.89442 0 -3.80735 0.21961 -5.59858 0.8599 c -0.894291 0.3175 -1.75154 0.73289 -2.56117 1.23031 c -0.809625 0.49742 -1.56369 1.07686 -2.27277 1.70656 c -0.425979 0.37836 -0.830792 0.78052 -1.21179 1.20121 c 0.383646 0.42069 0.785813 0.8255 1.21179 1.20121 c 0.709083 0.62971 1.46579 1.20915 2.27277 1.70656 c 0.806979 0.49742 1.66688 0.91282 2.56117 1.23032 c 1.79123 0.64293 3.70681 0.85989 5.59858 0.85989 h 5.28902 c 1.89442 0 3.80736 -0.2196 5.59859 -0.85989 c 0.89429 -0.3175 1.75154 -0.7329 2.56116 -1.23032 z" />
        <Path Width="35.48" Height="63.60" Fill="Blue" Opacity="{Binding SegmentBOpacity}" Data="F1 M 104.733 92.4613 c 0.005 0.05027 0.008 0.100542 0.008 0.153458 v 12.4222 c 0.42333 0.10848 0.84402 0.23548 1.26206 0.38364 c 0.97102 0.34396 1.90764 0.7964 2.77812 1.33615 c 0.87577 0.5371 1.67746 1.15623 2.43152 1.82298 c 0.4154 0.37041 0.81492 0.762 1.19857 1.17475 c 0.57943 -0.74877 1.08479 -1.55311 1.49225 -2.41036 c 0.81756 -1.7145 1.21973 -3.61685 1.21708 -5.51391 V 91.3712 c 0 -4.03754 -2.21721 -7.58031 -5.4954 -9.47473 z"/>
        <Path Width="35.48" Height="63.60" Fill="Blue" Opacity="{Binding SegmentDOpacity}" Data="F1 M 104.098 133.228 c -0.31221 0.26458 -0.71702 0.42333 -1.15888 0.42333 H 91.8237 c -0.994833 0 -1.80181 -0.80698 -1.80181 -1.80181 V 128.016 l -10.3796 4.04283 v 1.03452 c 0 6.01663 4.92125 10.9379 10.9379 10.9379 H 104.18 c 1.57162 0 3.06387 -0.33867 4.41854 -0.93927 l -4.50056 -9.86102 z" />
        <Path Width="35.48" Height="63.60" Fill="Blue" Opacity="{Binding SegmentFOpacity}" Data="F1 M 79.6396 101.83  v 0 c 0 1.89706 0.399521 3.79941 1.21708 5.51391 c 0.407458 0.85725 0.912813 1.66159 1.49225 2.41036 c 0.381 -0.41275 0.780521 -0.80698 1.19856 -1.17475 c 0.754063 -0.66675 1.55575 -1.28588 2.43152 -1.82298 c 0.870479 -0.53711 1.8071 -0.99219 2.77813 -1.33615 c 0.415396 -0.14816 0.838729 -0.27516 1.26206 -0.38364 V 97.663 L 79.6396 93.6202 Z" />
        <Path Width="35.48" Height="63.60" Fill="Blue" Opacity="{Binding SegmentCOpacity}" Data="F1 M 112.408 111.498 c -0.381 0.41275 -0.78052 0.80698 -1.19856 1.17475 c -0.75406 0.66675 -1.55575 1.28588 -2.43152 1.82298 c -0.87048 0.5371 -1.80711 0.99219 -2.77813 1.33615 c -0.41539 0.14816 -0.83873 0.27516 -1.26206 0.38364 v 15.6316 c 0 0.0185 0 0.0344 -0.003 0.0529 l 4.87098 10.6733 c 3.28613 -1.89177 5.51127 -5.43983 5.51127 -9.48531 v -13.6657 c 0 -1.89706 -0.39952 -3.79941 -1.21708 -5.51391 c -0.40746 -0.85725 -0.91281 -1.66159 -1.49225 -2.41036 z" />
        <Path Width="35.48" Height="63.60" Fill="Blue" Opacity="{Binding SegmentAOpacity}" Data="F1 M 90.0192 96.4486 v -3.83381 c 0 -0.994833 0.806979 -1.80181 1.80181 -1.80181 h 11.1151 c 0.42598 0 0.81756 0.148166 1.12712 0.396875 l 4.55084 -9.82662 c -1.35732 -0.608542 -2.8575 -0.949854 -4.43707 -0.949854 H 90.5775 c -6.01663 0 -10.9379 4.92125 -10.9379 10.9379 v 1.03452 z" />
"""

def transform_path(ma: re.Match) -> str:
    tl = []
    d1 = d2 = 0.0
    for item in str(ma.group(1)).replace(',', ' ').split():
        itr = item
        match item:
            case 'M' | 'L':
                (d1, d2) = (dx, dy)
            case 'H':
                d1 = dx
            case 'V':
                d1 = dy
            case _:
                if d1!=0:
                    itr = f'{float(item)+d1:.3f}'    # float() will raise an exception if it's not a float
                    d1 = d2
                    d2 = 0
        tl.append(itr)

    tr = " ".join(tl)
    return f'Data="{tr}"'

trans = data_re.sub(transform_path, xaml)
print()
print(trans)
